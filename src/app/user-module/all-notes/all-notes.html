<!-- Container principal -->
<div [class]="darkMode ? 'app-container dark' : 'app-container light'">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="logo"><div class="logo-icon"></div></div>
      <h1>Senai Notes</h1>
    </div>

    <div class="create-button-container">
      <button class="btn-create" (click)="createNewNote()">
        <span class="icon-plus">+</span>
        Create New Note
      </button>
    </div>

    <!-- Lista de notas -->
    <div class="notes-list">
      <button
        *ngFor="let note of filteredNotes"
        [class.active]="selectedNote === note.id"
        (click)="selectNote(note.id)"
        class="note-item"
      >
        <div [class]="'note-icon ' + (note.color || '')">
          <span class="icon">{{ note.icon }}</span>
        </div>
        <div class="note-info">
          <h3>{{ note.title }}</h3>
          <div class="note-tags" *ngIf="note.tags && note.tags.length > 0">
            <span *ngFor="let tag of note.tags" class="tag">{{ tag }}</span>
          </div>
          <p class="note-date">{{ note.date }}</p>
        </div>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="top-bar">
      <div class="search-container">
        <span class="search-icon">🔍</span>
        <input
          type="text"
          [(ngModel)]="searchQuery"
          placeholder="Search by title, content, or tags..."
          class="search-input"
        />
      </div>

      <button (click)="toggleDarkMode()" class="btn-theme">
        <span *ngIf="darkMode">☀️</span>
        <span *ngIf="!darkMode">🌙</span>
      </button>
      <button class="btn-logout" (click)="logout()">🚪 Logout</button>
    </div>

    <!-- Note Viewer/Editor: usa 'currentNote as note' para tipo seguro -->
    <div class="note-viewer" *ngIf="currentNote as note; else noContent">
      <div class="note-container">
        <div class="note-banner" [style.background]="note.content.banner">
          <div class="banner-circles">
            <div class="circle circle-1"></div>
            <div class="circle circle-2"></div>
          </div>
        </div>

        <!-- Editor Mode -->
        <div *ngIf="editMode; else viewMode" class="note-editor">
          <input
            type="text"
            [(ngModel)]="editingTitle"
            placeholder="Enter a title..."
            class="title-input"
          />

          <div class="note-meta">
            <div class="meta-item">
              <span class="meta-icon">🕒</span>
              <span class="meta-label">Last edited</span>
              <span class="meta-value">{{ note.content.lastEdited }}</span>
            </div>

            <div class="meta-item">
              <span class="meta-icon">🏷️</span>
              <span class="meta-label">Tags</span>
              <select
                class="tag-select"
                (change)="addTag($any($event.target).value); $any($event.target).value = ''"
              >
                <option value="">Select a tag</option>
                <option *ngFor="let tag of availableTags" [value]="tag">{{ tag }}</option>
              </select>
            </div>
          </div>

          <div class="selected-tags" *ngIf="editingTags.length > 0">
            <span *ngFor="let tag of editingTags" class="selected-tag">
              {{ tag }}
              <button (click)="removeTag(tag)" class="remove-tag">×</button>
            </span>
          </div>

          <textarea
            [(ngModel)]="editingBody"
            placeholder="Start typing your note here..."
            class="body-input"
          ></textarea>

          <div class="note-actions">
            <button class="btn-save" (click)="saveNote()">Save Note</button>
            <button class="btn-cancel" (click)="cancelEdit()">Cancel</button>
          </div>
        </div>

        <!-- View Mode -->
        <ng-template #viewMode>
          <div class="note-view" (dblclick)="enableEditMode()">
            <h1 class="note-title">{{ note.content.title }}</h1>

            <div class="note-meta">
              <div class="meta-item">
                <span class="meta-icon">🏷️</span>
                <span class="meta-label">Tags</span>
                <span *ngFor="let tag of note.content.tags" class="meta-value">{{ tag }}</span>
                <span *ngIf="!note.content.tags || note.content.tags.length === 0" class="meta-value-empty">No tags</span>
              </div>

              <div class="meta-item">
                <span class="meta-icon">🕒</span>
                <span class="meta-label">Last edited</span>
                <span class="meta-value">{{ note.content.lastEdited }}</span>
              </div>
            </div>

            <div class="note-body">{{ note.content.body }}</div>

            <div class="note-actions">
              <button class="btn-edit" (click)="enableEditMode()">Edit Note</button>
              <button class="btn-delete" (click)="deleteNote(note.id)">Delete</button>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- No Content Template -->
    <ng-template #noContent>
      <div class="no-content">
        <div class="no-content-icon">📝</div>
        <p>Select a note to view its content</p>
      </div>
    </ng-template>
  </div>
</div>
