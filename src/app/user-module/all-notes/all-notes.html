<div class="notes-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="logo-container"></div>
      <h1 class="app-title">Senai Notes</h1>
    </div>

    <nav class="sidebar-nav">
      <button 
        class="nav-item" 
        [class.active]="viewMode === 'list'"
        (click)="toggleViewMode()">
        <span class="nav-icon">
          <fa-icon [icon]="faHouse"></fa-icon>
        </span>
        All Notes
        <span class="nav-arrow">‚Ä∫</span>
      </button>

      <button 
        class="nav-item"
        [class.active]="viewMode === 'archived'"
        (click)="toggleViewMode()">
        <span class="nav-icon">
          <fa-icon [icon]="faBox"></fa-icon>
        </span>
        Archived Notes
      </button>
    </nav>

    <div class="tags-section">
      <h3 class="tags-title">Tags</h3>
      <div class="tags-list">
        <button 
          *ngFor="let tag of todasTags"
          class="tag-item"
          [class.active]="tagsFiltradas.includes(tag)"
          (click)="toggleTagFilter(tag)">
          <span class="nav-icon">üè∑Ô∏è</span>
          {{ tag }}
        </button>
      </div>
    </div>
  </div>

  <!-- √Årea principal -->
  <div class="main-content">
    <div class="notes-header">
      <h2 class="section-title">{{ viewMode === 'list' ? 'All Notes' : 'Archived Notes' }}</h2>
      
      <div class="header-actions">
        <input 
          type="text" 
          class="search-input"
          placeholder="Search by content or tags..."
          [formControl]="termoBusca">
        
        <button class="icon-button" (click)="ligarDesligarDarkMode()" title="Toggle Dark Mode">
          <fa-icon [icon]="darkMode ? faSun : faMoon"></fa-icon>
        </button>
        
        <button class="icon-button" (click)="logout()" title="Logout">
           <fa-icon [icon]="faUser"></fa-icon>
        </button>
      </div>
    </div>

    <button class="create-note-button" (click)="criarNovaNota()">
      + Create New Note
    </button>

    <div class="notes-list" *ngIf="notasFiltradas.length > 0">
      <div 
        *ngFor="let note of notasFiltradas"
        class="note-card"
        [class.selected]="notaSelecionada?.idNota === note.idNota"
        (click)="onNoteClick(note)">
        
        <img 
          *ngIf="note.urlImg" 
          [src]="note.urlImg" 
          alt="Imagem da nota" 
          class="note-card-banner">

        <div class="note-card-content">
          <div class="note-card-header">
            <div class="note-card-icon"></div>
            <div class="note-card-info">
              <h3 class="note-title">{{ note.descricao.length > 50 ? (note.descricao | slice:0:50) + '...' : note.descricao }}</h3>
            </div>
          </div>
          
          <div class="note-tags">
            <span *ngFor="let tag of note.tag" class="note-tag">
              {{ tag.nomeTag }}
            </span>
          </div>
          
          <p class="note-date">{{ formatarData(note.dataUpdate) }}</p>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="notasFiltradas.length === 0 && !modoCriacao">
      <p>{{ viewMode === 'list' ? 'You don\'t have any notes yet. Start a new note to capture your thoughts and ideas.' : 'You don\'t have any archived notes.' }}</p>
    </div>
  </div>

  <!-- Painel de detalhes/edi√ß√£o da nota -->
  <div class="note-details" *ngIf="notaSelecionada || modoCriacao">
    
    <!-- Modo Visualiza√ß√£o -->
    <ng-container *ngIf="!modoEdicao && !modoCriacao">
      <div class="note-detail-actions">
        <button class="action-icon-btn" (click)="modoEdicao = true" title="Edit Note">
          <fa-icon [icon]="faPenToSquare"></fa-icon>
        </button>
        <button class="action-icon-btn" title="Archive Note">
          <fa-icon [icon]="faBox"></fa-icon>
        </button>
        <button class="action-icon-btn danger" (click)="deletarNota()" title="Delete Note">
          <fa-icon [icon]="faTrash"></fa-icon>
        </button>
      </div>

      <img 
        *ngIf="notaSelecionada?.urlImg" 
        [src]="notaSelecionada?.urlImg" 
        alt="Imagem da nota selecionada" 
        class="note-detail-banner">

      <div class="note-detail-content">
        <div class="note-detail-header">
          <div class="note-detail-icon"></div>
          <h2 class="note-detail-title">Note #{{ notaSelecionada?.idNota }}</h2>
        </div>

        <div class="note-metadata">
          <div class="metadata-item">
            <span class="metadata-icon">üè∑Ô∏è</span>
            <span class="metadata-label">Tags</span>
            <div class="metadata-tags">
              <span *ngFor="let tag of notaSelecionada?.tag" class="metadata-tag">
                {{ tag.nomeTag }}
              </span>
              <span class="metadata-value">{{ (notaSelecionada?.status ?? false) ? 'Active' : 'Archived' }}</span>

                
              
            </div>
          </div>

          <div class="metadata-item">
            <span class="metadata-icon">üìß</span>
            <span class="metadata-label">Owner</span>
            <span class="metadata-value">{{ notaSelecionada?.email }}</span>
          </div>

          <div class="metadata-item">
            <span class="metadata-icon">üìÖ</span>
            <span class="metadata-label">Created</span>
            <span class="metadata-value">{{ formatarData(notaSelecionada?.dataCriacao) }}</span>
          </div>

          <div class="metadata-item">
            <span class="metadata-icon">üïê</span>
            <span class="metadata-label">Last edited</span>
            <span class="metadata-value">{{ formatarData(notaSelecionada?.dataUpdate) }}</span>
          </div>

          <div class="metadata-item">
            <span class="metadata-icon">üìä</span>
            <span class="metadata-label">Status</span>
            <span class="metadata-value">{{ notaSelecionada?.status ? 'Active' : 'Archived' }}</span>
          </div>
        </div>

        <h3 class="content-title">Content:</h3>
        <div class="note-content-text">{{ getDescricao() }}</div>
      </div>
    </ng-container>

    <!-- Modo Edi√ß√£o/Cria√ß√£o -->
    <ng-container *ngIf="modoEdicao || modoCriacao">
      <div class="note-detail-actions">
        <button class="action-icon-btn" (click)="cancelar()" title="Cancel">‚úñÔ∏è</button>
      </div>

      <div class="note-detail-content">
        <h2 class="form-section-title">{{ modoCriacao ? 'Create New Note' : 'Edit Note' }}</h2>

        <div class="form-group">
          <label class="form-label">Title</label>
          <input 
            type="text" 
            class="form-input"
            placeholder="Note title"
            [formControl]="tituloControl">
        </div>

        <div class="form-group">
          <label class="form-label">Tags (separated by commas)</label>
          <input 
            type="text" 
            class="form-input"
            placeholder="Dev, React, Personal..."
            [formControl]="tagsControl">
        </div>

        <div class="form-group">
          <label class="form-label">Image URL (optional)</label>
          <input 
            type="text" 
            class="form-input"
            placeholder="https://example.com/image.jpg"
            [formControl]="imagemUrlControl">
        </div>

        <div class="form-group">
          <label class="form-label">Content</label>
          <textarea 
            class="form-textarea"
            placeholder="Write your note content here..."
            [formControl]="conteudoControl"
            rows="15"></textarea>
        </div>

        <div class="form-actions">
          <button class="btn-primary" (click)="salvarNota()">
            {{ modoCriacao ? 'Create Note' : 'Save Changes' }}
          </button>
          <button class="btn-secondary" (click)="cancelar()">
            Cancel
          </button>
        </div>
      </div>
    </ng-container>
  </div>
</div>
